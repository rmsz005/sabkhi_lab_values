---
# Direct Immich chart configuration - values must be under immich: section
immich:
  persistence:
    library:
      existingClaim: "immich-ephemeral-pvc"

  server:
    ingress:
      main:
        enabled: true
        ingressClassName: nginx
        annotations:
          nginx.ingress.kubernetes.io/proxy-body-size: "0"
          nginx.ingress.kubernetes.io/proxy-read-timeout: "600"
          nginx.ingress.kubernetes.io/proxy-send-timeout: "600"
          cert-manager.io/cluster-issuer: "letsencrypt"
          cert-manager.io/common-name: "immich.internal.rmsz005.com"
        hosts:
          - host: immich.internal.rmsz005.com
            paths:
              - path: /
                pathType: Prefix
        tls:
          - hosts:
              - immich.internal.rmsz005.com
            secretName: immich-tls

image:
  tag: "v1.139.2"

# Use external PostgreSQL or disable for testing
postgresql:
  enabled: false

# Alternative: Use the new chart structure for PostgreSQL
# For testing, we'll disable PostgreSQL and let Immich use SQLite
env:
  DB_HOSTNAME: ""

redis:
  enabled: true
  architecture: standalone
  auth:
    enabled: false
  master:
    persistence:
      enabled: false

# Create the required ephemeral PVC
extraManifests:
  - apiVersion: v1
    kind: PersistentVolume
    metadata:
      name: immich-ephemeral-pv
    spec:
      capacity:
        storage: 10Gi
      accessModes:
        - ReadWriteOnce
      persistentVolumeReclaimPolicy: Delete
      storageClassName: ""
      hostPath:
        path: /tmp/immich-ephemeral
  - apiVersion: v1
    kind: PersistentVolumeClaim
    metadata:
      name: immich-ephemeral-pvc
      namespace: immich
    spec:
      accessModes:
        - ReadWriteOnce
      resources:
        requests:
          storage: 10Gi
      storageClassName: ""