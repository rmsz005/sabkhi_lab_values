---
# StorageClass: Strict data locality, single replica (true local performance)
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: longhorn-nvme-local-only
provisioner: driver.longhorn.io
allowVolumeExpansion: true
volumeBindingMode: WaitForFirstConsumer
parameters:
  numberOfReplicas: "1"
  dataLocality: "strict"
  diskSelector: "nvme"
  staleReplicaTimeout: "2880"
reclaimPolicy: Delete

---
# Test 1: STRICT locality (single replica, guaranteed local)
apiVersion: ripsaw.cloudbulldozer.io/v1alpha1
kind: Benchmark
metadata:
  name: locality-strict-nvme
  namespace: benchmark-operator
spec:
  cleanup: true
  elasticsearch:
    url: https://elastic:1BAg61MNY02o2Mps09or78BH@elasticsearch-es-http.elasticsearch.svc:9200
    verify_cert: false
  workload:
    name: "fio_distributed"
    args:
      prefill: false
      samples: 1
      servers: 1
      jobs: [write, read]
      bs: [64KiB]
      numjobs: [2]
      iodepth: [8]
      read_runtime: 30
      write_runtime: 30
      read_ramp_time: 5
      write_ramp_time: 5
      filesize: 1GiB
      storageclass: longhorn-nvme-local-only  # Strict local
      storagesize: 5Gi
      pin_server: "02-dell"  # Pin to node with NVMe

---
# Test 2: BEST-EFFORT locality (2 replicas, tries local)
apiVersion: ripsaw.cloudbulldozer.io/v1alpha1
kind: Benchmark
metadata:
  name: locality-besteffort-nvme
  namespace: benchmark-operator
spec:
  cleanup: true
  elasticsearch:
    url: https://elastic:1BAg61MNY02o2Mps09or78BH@elasticsearch-es-http.elasticsearch.svc:9200
    verify_cert: false
  workload:
    name: "fio_distributed"
    args:
      prefill: false
      samples: 1
      servers: 1
      jobs: [write, read]
      bs: [64KiB]
      numjobs: [2]
      iodepth: [8]
      read_runtime: 30
      write_runtime: 30
      read_ramp_time: 5
      write_ramp_time: 5
      filesize: 1GiB
      storageclass: longhorn-nvme-replicated  # Best-effort, 2 replicas
      storagesize: 5Gi
      pin_server: "02-dell"  # Same node

---
# Test 3: DISABLED locality (2 replicas, no pod pinning - worst case)
apiVersion: ripsaw.cloudbulldozer.io/v1alpha1
kind: Benchmark
metadata:
  name: locality-disabled-nvme
  namespace: benchmark-operator
spec:
  cleanup: true
  elasticsearch:
    url: https://elastic:1BAg61MNY02o2Mps09or78BH@elasticsearch-es-http.elasticsearch.svc:9200
    verify_cert: false
  workload:
    name: "fio_distributed"
    args:
      prefill: false
      samples: 1
      servers: 1
      jobs: [write, read]
      bs: [64KiB]
      numjobs: [2]
      iodepth: [8]
      read_runtime: 30
      write_runtime: 30
      read_ramp_time: 5
      write_ramp_time: 5
      filesize: 1GiB
      storageclass: longhorn-nvme-replicated  # Best-effort, 2 replicas
      storagesize: 5Gi
      # NO pin_server - pod can land anywhere

---
# Test 4: DISABLED + different storage class (HDD for comparison)
apiVersion: ripsaw.cloudbulldozer.io/v1alpha1
kind: Benchmark
metadata:
  name: locality-disabled-hd
  namespace: benchmark-operator
spec:
  cleanup: true
  elasticsearch:
    url: https://elastic:1BAg61MNY02o2Mps09or78BH@elasticsearch-es-http.elasticsearch.svc:9200
    verify_cert: false
  workload:
    name: "fio_distributed"
    args:
      prefill: false
      samples: 1
      servers: 1
      jobs: [write, read]
      bs: [64KiB]
      numjobs: [2]
      iodepth: [8]
      read_runtime: 30
      write_runtime: 30
      read_ramp_time: 5
      write_ramp_time: 5
      filesize: 1GiB
      storageclass: longhorn-hd-replicated
      storagesize: 5Gi
      # NO pin_server


